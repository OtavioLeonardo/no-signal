@import "tailwindcss";

@plugin "@tailwindcss/typography";

@custom-variant dark (&:where(.dark, .dark *));

/* --- 1. Base Layer: è‹¹æœé£æ ¼å…¨å±€èƒŒæ™¯ --- */
@layer base {
    body {
        @apply bg-[#F5F5F7] text-[#1D1D1F] antialiased;
        /* âœ… æ–°å¢ï¼šé˜²æ­¢æ¨ªå‘æº¢å‡ºï¼Œä½†ä½¿ç”¨ clip ä»¥ä¿æŠ¤ sticky ä¸Šä¸‹æ–‡ */
        overflow-x: clip;
    }

    .dark body {
        /* æ·±è‰²æ¨¡å¼ï¼šæ·±ç©ºç° (macOS é£æ ¼)ï¼Œæ¯”çº¯é»‘æ›´æœ‰è´¨æ„Ÿ */
        @apply bg-[#000000] text-[#F5F5F7];
    }
}

/* --- 2. Utilities Layer: ä½ çš„è‡ªå®šä¹‰ä»£ç é«˜äº® (å®Œæ•´ä¿ç•™) --- */
@layer utilities {
    .content pre {
        @apply p-0;
    }

    .content code {
        @apply overflow-x-auto;
    }

    .content [data-rehype-pretty-code-figure] code {
        @apply p-0;
    }

    .content pre>code span[data-line] {
        @apply border-l-8 border-transparent px-2;
    }

    .content pre>code span:first-of-type {
        @apply rounded-t-lg pt-2;
    }

    .content pre>code span:last-of-type {
        @apply rounded-b-lg pb-2;
    }

    .content pre>code .highlighted {
        @apply border-l-8 !border-gray-300/60 bg-gray-200/5;
    }

    .content pre>code[data-line-numbers] {
        counter-reset: line;
    }

    .content pre>code[data-line-numbers]>span[data-line]::before {
        counter-increment: line;
        content: counter(line);
        @apply mr-8 inline-block w-4 text-left text-[#7ca2dfad];
    }

    .content pre>code>span[data-line]::before {
        content: '';
        @apply inline-block w-4 text-right;
    }

    .content pre>code[data-line-numbers-max-digits='2']>span[data-line]::before {
        @apply w-8;
    }

    .content code[data-line-numbers-max-digits='3']>span[data-line]::before {
        @apply w-12;
    }
}

/* --- 3. Components Layer: ç»„ä»¶æ ·å¼ --- */
@layer components {

    /* --- é€šç”¨ Apple Card ç»„ä»¶ (æ¨èç”¨äºåŒ…è£¹ä½ çš„æ–‡ç« ä¸»ä½“) --- */
    .apple-card {
        @apply bg-white rounded-2xl border border-black/5 shadow-sm transition-all duration-300;
    }

    .dark .apple-card {
        @apply bg-[#1C1C1E] border-white/10 shadow-none;
    }

    /* --- iOS é£æ ¼ Markdown Alerts / Callouts --- */
    /* è®¾è®¡è¯­è¨€å˜åŒ–ï¼š
       - ç§»é™¤å·¦ä¾§ç²—è¾¹æ¡†ï¼Œæ”¹ä¸ºå››å‘¨ç»†è¾¹æ¡†
       - å¢åŠ å¤§åœ†è§’ (rounded-2xl)
       - å¢åŠ èƒŒæ™¯é€æ˜åº¦ä¸æ¯›ç»ç’ƒæ„Ÿ (backdrop-blur)
       - å›¾æ ‡æ”¹ä¸ºåœ†å½¢èƒŒæ™¯åŒ…è£¹
    */

    .markdown-alert {
        @apply mb-6 rounded-2xl border p-4 text-[15px] leading-relaxed relative overflow-hidden transition-all duration-200 backdrop-blur-md;

        /* é»˜è®¤å˜é‡å…œåº• */
        --alert-bg: theme('colors.gray.50');
        --alert-border: theme('colors.gray.200');
        --alert-text: theme('colors.gray.800');
        --alert-icon-bg: theme('colors.gray.200');

        background-color: var(--alert-bg);
        border-color: var(--alert-border);
        color: var(--alert-text);
    }

    /* æ ‡é¢˜æ ·å¼ï¼šå…¨å¤§å†™ã€å­—å·å°ä½†åŠ ç²—ï¼Œç±»ä¼¼ iOS è®¾ç½®é‡Œçš„åˆ†ç»„æ ‡é¢˜ */
    .markdown-alert-title {
        @apply flex items-center font-bold mb-3 text-xs uppercase tracking-wider opacity-80;
    }

    .markdown-alert-title>svg {
        @apply hidden;
    }

    .markdown-alert p {
        @apply text-inherit opacity-95 m-0;
    }

    .markdown-alert>*:last-child {
        @apply mb-0;
    }

    /* Emoji å›¾æ ‡å®¹å™¨ï¼šåœ†å½¢èƒŒæ™¯ï¼Œçœ‹èµ·æ¥åƒ App Icon */
    .markdown-alert-title::before {
        @apply inline-flex items-center justify-center w-6 h-6 mr-2 text-sm rounded-full bg-[var(--alert-icon-bg)] not-italic shadow-sm;
        font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
    }

    /* --- ç±»å‹å®šä¹‰ (é…è‰²è°ƒæ•´ä¸ºæ›´æŸ”å’Œçš„é«˜çº§è‰²) --- */

    /* 1. Important (ç´«è‰² - ç±»ä¼¼ iOS ä¸“æ³¨æ¨¡å¼) ğŸ’¬ */
    .markdown-alert-important {
        --alert-bg: rgba(245, 243, 255, 0.6);
        --alert-border: rgba(168, 85, 247, 0.15);
        --alert-text: #6b21a8;
        --alert-icon-bg: #f3e8ff;

        &:where(.dark, .dark *) {
            --alert-bg: rgba(59, 7, 100, 0.4);
            --alert-border: rgba(147, 51, 234, 0.3);
            --alert-text: #e9d5ff;
            --alert-icon-bg: rgba(147, 51, 234, 0.4);
        }
    }

    .markdown-alert-important .markdown-alert-title::before {
        content: "ğŸ’¬";
    }

    /* 2. Note (è“è‰² - ç±»ä¼¼ iOS ç³»ç»Ÿæç¤º) â„¹ï¸ */
    .markdown-alert-note {
        --alert-bg: rgba(239, 246, 255, 0.6);
        --alert-border: rgba(59, 130, 246, 0.15);
        --alert-text: #1e40af;
        --alert-icon-bg: #dbeafe;

        &:where(.dark, .dark *) {
            --alert-bg: rgba(23, 37, 84, 0.4);
            --alert-border: rgba(59, 130, 246, 0.3);
            --alert-text: #bfdbfe;
            --alert-icon-bg: rgba(37, 99, 235, 0.4);
        }
    }

    .markdown-alert-note .markdown-alert-title::before {
        content: "â„¹ï¸";
    }

    /* 3. Tip (ç»¿è‰² - ç±»ä¼¼ Fitness/Health) ğŸ’¡ */
    .markdown-alert-tip {
        --alert-bg: rgba(240, 253, 244, 0.6);
        --alert-border: rgba(34, 197, 94, 0.15);
        --alert-text: #15803d;
        --alert-icon-bg: #dcfce7;

        &:where(.dark, .dark *) {
            --alert-bg: rgba(5, 46, 22, 0.4);
            --alert-border: rgba(34, 197, 94, 0.3);
            --alert-text: #bbf7d0;
            --alert-icon-bg: rgba(21, 128, 61, 0.4);
        }
    }

    .markdown-alert-tip .markdown-alert-title::before {
        content: "ğŸ’¡";
    }

    /* 4. Warning (æ©™è‰² - ç±»ä¼¼ä½ç”µé‡æ¨¡å¼) âš ï¸ */
    .markdown-alert-warning {
        --alert-bg: rgba(255, 247, 237, 0.6);
        --alert-border: rgba(249, 115, 22, 0.15);
        --alert-text: #9a3412;
        --alert-icon-bg: #ffedd5;

        &:where(.dark, .dark *) {
            --alert-bg: rgba(67, 20, 7, 0.4);
            --alert-border: rgba(249, 115, 22, 0.3);
            --alert-text: #fed7aa;
            --alert-icon-bg: rgba(194, 65, 12, 0.4);
        }
    }

    .markdown-alert-warning .markdown-alert-title::before {
        content: "âš ï¸";
    }

    /* 5. Caution (çº¢è‰² - é”™è¯¯) ğŸ›‘ */
    .markdown-alert-caution {
        --alert-bg: rgba(254, 242, 242, 0.6);
        --alert-border: rgba(239, 68, 68, 0.15);
        --alert-text: #991b1b;
        --alert-icon-bg: #fee2e2;

        &:where(.dark, .dark *) {
            --alert-bg: rgba(69, 10, 10, 0.4);
            --alert-border: rgba(239, 68, 68, 0.3);
            --alert-text: #fecaca;
            --alert-icon-bg: rgba(185, 28, 28, 0.4);
        }
    }

    .markdown-alert-caution .markdown-alert-title::before {
        content: "ğŸ›‘";
    }
}

/* ...ä¿ç•™ä½ ä¹‹å‰çš„ @tailwind å’Œ .markdown-alert ä»£ç ... */

@layer utilities {

    /* 1. ä¼˜é›…çš„å…¥åœºåŠ¨ç”» (Fade Up) 
       Apple çš„é¡µé¢åŠ è½½é€šå¸¸ä¼´éšç€å†…å®¹è½»å¾®ä¸Šæµ®å’Œé€æ˜åº¦å˜åŒ– 
    */
    .animate-enter-content {
        animation: enter 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    /* ä¾æ¬¡å»¶è¿Ÿå…¥åœºï¼Œç”¨äºåˆ—è¡¨é¡¹ï¼Œåˆ¶é€ â€œç€‘å¸ƒæµâ€æ„Ÿè§‰ */
    .delay-100 {
        animation-delay: 100ms;
    }

    .delay-200 {
        animation-delay: 200ms;
    }

    .delay-300 {
        animation-delay: 300ms;
    }

    @keyframes enter {
        from {
            opacity: 0;
            transform: translateY(10px);
            /* ç¨å¾®å‘ä¸‹åç§»ä¸€ç‚¹ç‚¹ */
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* 2. éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ (Mac é£æ ¼) */
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* 3. æè‡´çš„å¹³æ»‘å­—ä½“æ¸²æŸ“ */
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }
}

/* --- Global Scrollbar Styling --- */
@media (min-width: 640px) {
    ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        @apply bg-gray-300 dark:bg-gray-700;
        border: 3px solid transparent;
        background-clip: content-box;
        border-radius: 9999px;
    }

    ::-webkit-scrollbar-thumb:hover {
        @apply bg-gray-400 dark:bg-gray-600;
    }
}

/* 4. ä¼˜åŒ– ViewTransitions çš„é»˜è®¤è¡Œä¸ºï¼Œè®©å®ƒæ›´æŸ”å’Œ */
::view-transition-old(root),
::view-transition-new(root) {
    animation-duration: 0.3s;
}