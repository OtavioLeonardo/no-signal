---
import Base from '@/layouts/Base.astro';
import Section from '@/components/Section.astro';
---

<Base head={{ title: 'Search', description: 'Search my digital garden' }}>
  <Section>
    <div class="py-12 md:py-20 max-w-2xl mx-auto">
      <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-gray-900 dark:text-white mb-4">Search</h1>
        <p class="text-gray-500">Find insights, notes, and thoughts.</p>
      </div>
      
      <link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
      
      {/* 搜索容器: 增加 backdrop-blur 和精致的阴影 */}
      <div class="relative group">
        <div class="absolute -inset-1 bg-gradient-to-r from-blue-100 to-purple-100 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
        <div id="search" class="relative p-6 bg-white dark:bg-[#1C1C1E] rounded-2xl shadow-sm border border-gray-100 dark:border-white/10"></div>
      </div>
    </div>
  </Section>
</Base>

<script>
  import { PagefindUI } from "@pagefind/default-ui";
  document.addEventListener("DOMContentLoaded", () => {
    new PagefindUI({
      element: "#search",
      showSubResults: true,
      resetStyles: false, 
      bundlePath: "/pagefind/", 
      language: "zh", 
      showImages: false, // 建议关闭图片，让列表更紧凑
    });

    const el = document.querySelector(".pagefind-ui");
    const input = el?.querySelector<HTMLInputElement>(`input[type="text"]`);
    const clearButton = el?.querySelector(".pagefind-ui__search-clear");

    // URL 同步逻辑保持不变 (这是好功能)
    const url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    const query = params.get("q");

    if (query && input) {
      input.value = query;
      input.dispatchEvent(new Event("input", { bubbles: true }));
    }

    input?.addEventListener("input", (e) => {
      const target = e.target as HTMLInputElement;
      const url = new URL(window.location.href);
      const params = new URLSearchParams(url.search);
      if (target.value) {
        params.set("q", target.value);
      } else {
        params.delete("q");
      }
      window.history.replaceState({}, "", `${url.pathname}?${params}`);
    });

    clearButton?.addEventListener("click", () => {
      const url = new URL(window.location.href);
      const params = new URLSearchParams(url.search);
      params.delete("q");
      window.history.replaceState({}, "", `${url.pathname}`);
    });
  });
</script>

<style is:global>
  /* Apple Style Spotlight Overrides */
  :root {
    --pagefind-ui-scale: 0.95;
    --pagefind-ui-primary: #2563eb; /* Apple Blue */
    --pagefind-ui-text: #1f2937;
    --pagefind-ui-background: transparent;
    --pagefind-ui-border: #f3f4f6;
    --pagefind-ui-tag: #f3f4f6;
    --pagefind-ui-border-radius: 0.75rem;
    --pagefind-ui-font: 'Inter', sans-serif;
  }

  html.dark {
    --pagefind-ui-text: #e5e7eb;
    --pagefind-ui-background: transparent;
    --pagefind-ui-border: #27272a;
    --pagefind-ui-tag: #27272a;
  }

  /* 输入框美化 */
  .pagefind-ui__search-input {
    background-color: #f3f4f6 !important; /* iOS 灰色输入框 */
    border: 1px solid transparent !important;
    border-radius: 12px !important;
    padding: 12px 16px !important;
    font-size: 1rem !important;
    transition: all 0.2s;
  }
  
  html.dark .pagefind-ui__search-input {
    background-color: #2c2c2e !important;
    color: white !important;
  }

  .pagefind-ui__search-input:focus {
    background-color: white !important;
    border-color: #2563eb !important;
    box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1) !important;
  }
  html.dark .pagefind-ui__search-input:focus {
    background-color: #1c1c1e !important;
  }

  /* 结果列表美化 */
  .pagefind-ui__result {
    border: none !important;
    border-bottom: 1px solid #f3f4f6 !important;
    padding: 16px 0 !important;
  }
  html.dark .pagefind-ui__result {
    border-bottom: 1px solid #27272a !important;
  }

  .pagefind-ui__result-title {
    font-weight: 600 !important;
    font-size: 1.1rem !important;
  }

  .pagefind-ui__message {
    color: #9ca3af !important;
    padding: 20px 0 !important;
    text-align: center;
  }
  
  /* 隐藏 Pagefind 默认的按钮，让它更像纯输入框 */
  .pagefind-ui__search-clear {
    background-color: transparent !important;
  }
</style>