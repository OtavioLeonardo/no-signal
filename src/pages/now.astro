---
import Base from '@/layouts/Base.astro';
import Section from '@/components/Section.astro';
import Heading from '@/components/Heading.astro';
import { AppConfig } from '@/utils/AppConfig';
import { getEntry } from 'astro:content';

// 1. 获取数据
const nowPage = await getEntry('pages', 'now');

// 如果还没去后台创建数据，给个提示
if (!nowPage) {
  return new Response('请先去 Keystatic 后台创建 Now 页面内容', { status: 404 });
}

const { title } = AppConfig;
const { updatedDate } = nowPage.data;
// 2. 渲染 Markdown 正文
const { Content } = await nowPage.render();

// 格式化日期
const lastUpdated = updatedDate.toISOString().split('T')[0];
---

<Base head={{ title: `Now - ${title}`, description: "What I'm doing now" }}>
    <Section>
        {/* 头部区域：标题 + 更新日期 */}
        <div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between gap-4 mb-8 border-b border-stone-200 dark:border-stone-800 pb-8">
            <div>
                <Heading title="Now" />
                <p class="text-stone-500 dark:text-stone-400 mt-2">
                    這不是關於我是誰，而是關於我<strong class="text-stone-800 dark:text-stone-200">此時此刻</strong>在做什麼。
                </p>
            </div>
            
            <div class="shrink-0">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300 border border-orange-200 dark:border-orange-800">
                    <span class="w-2 h-2 mr-2 rounded-full bg-orange-500 animate-pulse"></span>
                    Last Updated: {lastUpdated}
                </span>
            </div>
        </div>
    </Section>

    <Section>
        {/* 正文区域：完全由 Markdown 接管 */}
        <div class="prose prose-lg prose-stone dark:prose-invert max-w-none 
            prose-headings:font-bold 
            prose-a:text-orange-600 prose-a:no-underline hover:prose-a:underline
            prose-li:marker:text-orange-500">
            
            <Content />
            
        </div>
    </Section>
</Base>