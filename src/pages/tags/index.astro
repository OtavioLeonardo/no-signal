---
import Heading from '@/components/Heading.astro';
import Section from '@/components/Section.astro';
import Tag from '@/components/Tag.astro';
import Base from '@/layouts/Base.astro';
import { AppConfig } from '@/utils/AppConfig';
import type { MarkdownInstance } from 'astro';

const { title } = AppConfig;
const { description } = AppConfig;

const allPosts = Object.values(
	import.meta.glob('../posts/*.md', { eager: true })
) as MarkdownInstance<any>[];
const allTags = allPosts.map((post) => post.frontmatter.tags).flat();
const uniqueTags: Set<string> = new Set(allTags);
let tagMap: Record<string, number> = {};

[...uniqueTags].forEach((tag) => {
	const count = allTags.filter((t) => t === tag).length;
	tagMap[tag] = count;
});

tagMap = Object.fromEntries(Object.entries(tagMap).sort((a, b) => b[1] - a[1]));
---

<Base head={{ title, description }}>
	<Section><Heading title="Posts by Tag" /></Section>
	
	<div class="mx-auto grid w-full max-w-screen-md grid-cols-2 gap-4 px-4 md:grid-cols-3 md:px-0">
		{
			Object.entries(tagMap).map(([tag, count]) => (
				<a
					class="group flex items-center justify-between rounded-lg border border-stone-200 bg-stone-50 px-3 py-3 transition-all hover:-translate-y-0.5 hover:border-orange-500 hover:bg-white hover:shadow-sm dark:border-stone-700 dark:bg-stone-800 dark:hover:border-orange-500 dark:hover:bg-stone-900"
					href={`/tags/${tag}`}
				>
					<div class="flex items-center gap-2">
						{/* Tag 組件 */}
						<Tag tag={tag} />
					</div>
					
					{/* 數量顯示：加個淡色背景讓它像個 badge */}
					<span class="rounded-full bg-stone-200 px-2 py-0.5 text-xs font-bold text-stone-600 dark:bg-stone-700 dark:text-stone-300">
						{count}
					</span>
				</a>
			))
		}
	</div>
</Base>