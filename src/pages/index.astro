---
import { AppConfig } from '@/utils/AppConfig';
import Base from '@/layouts/Base.astro';
import Hero from '@/components/Hero.astro';
import Section from '@/components/Section.astro';
import LatestPosts from '@/components/LatestPosts.astro';
// âœ… å¼•å…¥ Astro ä¸“é—¨è¯»å–å†…å®¹çš„ API
import { getCollection } from 'astro:content'; 

const { title } = AppConfig;
const { description } = AppConfig;

// âœ… 1. è¯»å–æ•°æ®
const allPosts = await getCollection('posts');

// âœ… 2. æ’åºé€»è¾‘å‡çº§ï¼šå…ˆç½®é¡¶ï¼ŒåæŒ‰æ—¶é—´
allPosts.sort((a, b) => {
    // è·å–ç½®é¡¶çŠ¶æ€ (å¦‚æœæ²¡è®¾ç½®ï¼Œé»˜è®¤ä¸º false)
    const isAPinned = a.data.isPinned || false;
    const isBPinned = b.data.isPinned || false;

    // å¦‚æœ A ç½®é¡¶äº†ï¼ŒB æ²¡ç½®é¡¶ï¼ŒA æ’å‰é¢
    if (isAPinned && !isBPinned) {
        return -1;
    }
    // å¦‚æœ B ç½®é¡¶äº†ï¼ŒA æ²¡ç½®é¡¶ï¼ŒB æ’å‰é¢
    if (!isAPinned && isBPinned) {
        return 1;
    }

    // å¦‚æœå¤§å®¶éƒ½ä¸€æ ·ï¼ˆéƒ½ç½®é¡¶æˆ–éƒ½ä¸ç½®é¡¶ï¼‰ï¼Œå°±æŒ‰å‘å¸ƒæ—¶é—´å€’åº
    return b.data.pubDate.valueOf() - a.data.pubDate.valueOf();
});

// å–å‰ 3 ç¯‡ (æ­¤æ—¶ç½®é¡¶çš„æ–‡ç« ä¸€å®šä¼šåŒ…å«åœ¨å†…ï¼Œé™¤éä½ ç½®é¡¶äº†è¶…è¿‡3ç¯‡)
const latestPosts = allPosts.slice(0, 3);

// å¸¸ç”¨æ ‡ç­¾é…ç½®
const popularTags = [
    { name: 'éŸ³æ¨‚æ•™å­¸', slug: 'éŸ³æ¨‚æ•™å­¸' },
    { name: 'æ”å½±', slug: 'æ”å½±' },
    { name: 'å€‹äººæ€è€ƒ', slug: 'å€‹äººæ€è€ƒ' },
    { name: 'è³½é“åˆ†æ', slug: 'è³½é“åˆ†æ' },
];
---

<Base head={{ title, description }}>
    <Hero />

    {/* æ ‡ç­¾åŒºå— */}
    <Section>
        <div class="py-8 border-b border-stone-200 dark:border-stone-800">
            <div class="flex items-center gap-2 mb-4">
                <span class="text-xl">ğŸ·ï¸</span>
                <h3 class="font-bold text-lg text-stone-800 dark:text-stone-200">
                    Explore Topics
                </h3>
            </div>

            <div class="flex flex-wrap gap-3">
                {popularTags.map((tag) => (
                    <a 
                        href={`/tags/${tag.slug}`} 
                        class="px-4 py-1.5 rounded-full bg-stone-100 dark:bg-stone-800 text-stone-600 dark:text-stone-300 text-sm font-medium hover:bg-orange-500 hover:text-white dark:hover:bg-orange-600 dark:hover:text-white transition-all transform hover:-translate-y-0.5"
                    >
                        #{tag.name}
                    </a>
                ))}
            </div>
        </div>
    </Section>

    <LatestPosts posts={latestPosts} />
</Base>