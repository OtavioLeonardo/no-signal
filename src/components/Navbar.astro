---
import Section from './Section.astro';
---

<header class="sticky top-0 z-50 w-full border-b border-black/5 dark:border-white/10 bg-[#F5F5F7]/80 dark:bg-black/80 backdrop-blur-xl transition-all duration-300">
	<Section>
		<div class="flex h-16 items-center justify-between">
			
			{/* Logo 区域 */}
			<div class="flex-shrink-0">
				<a href="/" class="group flex items-center gap-3 transition-opacity hover:opacity-80">
					
					{/* Logo 图片 */}
					<img 
						src="/nobg.png" 
						alt="No Signal Logo" 
						class="h-9 w-auto md:h-10" 
					/>

					{/* 文字部分 */}
					<div class="flex flex-col justify-center">
						<span class="font-bold text-2xl md:text-3xl tracking-tighter leading-none text-gray-900 dark:text-white">
							no<span class="text-orange-600">.</span>signal
						</span>
					</div>
				</a>
			</div>
			
			{/* Desktop Navigation */}
			<div class="hidden sm:flex items-center gap-6">
				<nav>
					<ul class="flex items-center gap-1 font-medium text-sm">
						{['TAGS', 'POSTS', 'DIARY', 'TOOLS', 'NOW', 'RESEARCH'].map((item) => (
							<li>
								<a 
									href={item === 'POSTS' ? '/posts' : `/${item.toLowerCase()}`} 
									class="px-3 py-2 rounded-lg text-gray-600 hover:text-black hover:bg-black/5 dark:text-gray-300 dark:hover:text-white dark:hover:bg-white/10 transition-all"
								>
									{item}
								</a>
							</li>
						))}
					</ul>
				</nav>

				{/* Desktop Theme Switcher */}
				<div class="pl-2 border-l border-gray-200 dark:border-gray-800">
					<input type="checkbox" id="light-switch-desktop" class="light-switch sr-only" />
					<label class="relative cursor-pointer flex items-center justify-center p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors" for="light-switch-desktop">
						<svg class="dark:hidden w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
							<path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
						</svg>
						<svg class="hidden dark:block w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
							<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
						</svg>
						<span class="sr-only">Switch theme</span>
					</label>
				</div>
			</div>

			<button id="mobile-menu-button" class="sm:hidden p-2 rounded-lg text-gray-600 hover:bg-black/5 dark:text-gray-300" aria-label="Toggle mobile menu">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</div>

		<div
			id="mobile-menu"
			class="hidden sm:hidden mt-2 mb-4 overflow-hidden rounded-2xl border border-black/5 bg-white/90 backdrop-blur-xl shadow-lg dark:bg-stone-900/90 dark:border-white/10"
		>
			<nav class="flex flex-col p-2 text-sm font-medium">
				{['TAGS', 'POSTS', 'DIARY', 'TOOLS', 'RESEARCH', 'NOW'].map((item) => (
					<a href={item === 'POSTS' ? '/posts' : `/${item.toLowerCase()}`} class="px-4 py-3 rounded-xl hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
						{item}
					</a>
				))}
				
				<div class="mt-2 pt-2 border-t border-gray-100 dark:border-white/5 px-4 py-3 flex items-center justify-between">
					<span class="text-gray-500">Appearance</span>
					<input type="checkbox" id="light-switch-mobile" class="light-switch sr-only" />
					<label class="relative cursor-pointer p-2 rounded-full bg-gray-100 dark:bg-white/10" for="light-switch-mobile">
						<svg class="dark:hidden w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
						<svg class="hidden dark:block w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
					</label>
				</div>
			</nav>
		</div>
	</Section>
</header>

<script>
    // 1. 定义核心切换逻辑
    function initTheme() {
        const lightSwitches = document.querySelectorAll('.light-switch');
        const isDarkTheme = localStorage.getItem('theme') === 'dark';

        // A. 初始化：根据 LocalStorage 设置 class
        if (isDarkTheme) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // B. 初始化：设置所有开关状态
        lightSwitches.forEach((lightSwitch) => {
            (lightSwitch as HTMLInputElement).checked = isDarkTheme;
        });

        // C. 绑定事件
        lightSwitches.forEach((lightSwitch) => {
            lightSwitch.addEventListener('change', () => {
                const isChecked = (lightSwitch as HTMLInputElement).checked;
                
                // 切换 HTML class
                if (isChecked) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }

                // 同步所有开关的状态
                document.querySelectorAll('.light-switch').forEach((s) => {
                    (s as HTMLInputElement).checked = isChecked;
                });
            });
        });
    }

    // 2. 监听 'astro:page-load' 事件
    document.addEventListener('astro:page-load', initTheme);
    
    // 3. 处理移动端菜单的逻辑
    document.addEventListener('astro:page-load', () => {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        if (mobileMenuButton && mobileMenu) {
            // 每次页面加载先重置菜单状态
            mobileMenu.classList.add('hidden');
            mobileMenuButton.setAttribute('aria-expanded', 'false');
            mobileMenuButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>`;

            mobileMenuButton.addEventListener('click', () => {
                const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
                mobileMenuButton.setAttribute('aria-expanded', (!expanded).toString());
                mobileMenu.classList.toggle('hidden');

                // 切换图标
                if (!expanded) {
                    mobileMenuButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>`;
                } else {
                    mobileMenuButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>`;
                }
            });
        }
    });
</script>